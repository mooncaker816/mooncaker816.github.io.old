
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>The Go Programming Language Ex（6） | Mooncaker816</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Ex 5.1Change the findlinks program to traverse the n.FirstChild linked list using recursive calls to visit instead of a loop.">
<meta name="keywords" content="The Go Programming Language Ex,Go Func,Go crawler">
<meta property="og:type" content="article">
<meta property="og:title" content="The Go Programming Language Ex（6）">
<meta property="og:url" content="https://mooncaker816.github.io/2017/12/28/The-Go-Programming-Language-Ex (6)/index.html">
<meta property="og:site_name" content="Mooncaker816">
<meta property="og:description" content="Ex 5.1Change the findlinks program to traverse the n.FirstChild linked list using recursive calls to visit instead of a loop.">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-01-03T01:01:18.460Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The Go Programming Language Ex（6）">
<meta name="twitter:description" content="Ex 5.1Change the findlinks program to traverse the n.FirstChild linked list using recursive calls to visit instead of a loop.">
  
    <link rel="alternative" href="/atom.xml" title="Mooncaker816" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Mooncaker816</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="mooncaker816.github.io">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-The-Go-Programming-Language-Ex (6)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/28/The-Go-Programming-Language-Ex (6)/" class="article-date">
  <time datetime="2017-12-27T16:00:00.000Z" itemprop="datePublished">2017-12-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Golang/">Golang</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      The Go Programming Language Ex（6）
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Ex-5-1"><a href="#Ex-5-1" class="headerlink" title="Ex 5.1"></a>Ex 5.1</h3><p>Change the findlinks program to traverse the n.FirstChild linked list using recursive calls to visit instead of a loop.</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"golang.org/x/net/html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	doc, err := html.Parse(os.Stdin)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Fprintf(os.Stderr, <span class="string">"findlinks1: %v\n"</span>, err)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, link := <span class="keyword">range</span> visit(<span class="literal">nil</span>, doc) &#123;</span><br><span class="line">		fmt.Println(link)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// visit appends to links each link found in n and returns the result.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">visit</span><span class="params">(links []<span class="keyword">string</span>, n *html.Node)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> n == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> links</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> n.Type == html.ElementNode &amp;&amp; n.Data == <span class="string">"a"</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> _, a := <span class="keyword">range</span> n.Attr &#123;</span><br><span class="line">				<span class="keyword">if</span> a.Key == <span class="string">"href"</span> &#123;</span><br><span class="line">					links = <span class="built_in">append</span>(links, a.Val)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		links = visit(links, n.FirstChild)</span><br><span class="line">		links = visit(links, n.NextSibling)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> links</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ ./ex1.7 http://www.baidu.com | ./ex5.1</span><br><span class="line">/</span><br><span class="line">javascript:;</span><br><span class="line">javascript:;</span><br><span class="line">javascript:;</span><br><span class="line">/</span><br><span class="line">javascript:;</span><br><span class="line">https://passport.baidu.com/v2/?login&amp;tpl=mn&amp;u=http%3A%2F%2Fwww.baidu.com%2F</span><br><span class="line">http://news.baidu.com</span><br><span class="line">http://www.hao123.com</span><br><span class="line">http://map.baidu.com</span><br><span class="line">http://v.baidu.com</span><br><span class="line">http://tieba.baidu.com</span><br><span class="line">http://xueshu.baidu.com</span><br><span class="line">https://passport.baidu.com/v2/?login&amp;tpl=mn&amp;u=http%3A%2F%2Fwww.baidu.com%2F</span><br><span class="line">http://www.baidu.com/gaoji/preferences.html</span><br><span class="line">http://www.baidu.com/more/</span><br><span class="line">http://news.baidu.com/ns?cl=2&amp;rn=20&amp;tn=news&amp;word=</span><br><span class="line">http://tieba.baidu.com/f?kw=&amp;fr=wwwt</span><br><span class="line">http://zhidao.baidu.com/q?ct=17&amp;pn=0&amp;tn=ikaslist&amp;rn=10&amp;word=&amp;fr=wwwt</span><br><span class="line">http://music.baidu.com/search?fr=ps&amp;ie=utf-8&amp;key=</span><br><span class="line">http://image.baidu.com/search/index?tn=baiduimage&amp;ps=1&amp;ct=201326592&amp;lm=-1&amp;cl=2&amp;nc=1&amp;ie=utf-8&amp;word=</span><br><span class="line">http://v.baidu.com/v?ct=301989888&amp;rn=20&amp;pn=0&amp;db=0&amp;s=25&amp;ie=utf-8&amp;word=</span><br><span class="line">http://map.baidu.com/m?word=&amp;fr=ps01000</span><br><span class="line">http://wenku.baidu.com/search?word=&amp;lm=0&amp;od=0&amp;ie=utf-8</span><br><span class="line">//www.baidu.com/more/</span><br><span class="line">//www.baidu.com/cache/sethelp/help.html</span><br><span class="line">http://home.baidu.com</span><br><span class="line">http://ir.baidu.com</span><br><span class="line">http://e.baidu.com/?refer=888</span><br><span class="line">http://www.baidu.com/duty/</span><br><span class="line">http://jianyi.baidu.com/</span><br><span class="line">http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11000002000001</span><br></pre></td></tr></table></figure>
<h3 id="Ex-5-2"><a href="#Ex-5-2" class="headerlink" title="Ex 5.2"></a>Ex 5.2</h3><p>Write a function to populate a mapping from element names—p, div, span, and so on—to the number of elements with that name in an HTML document tree.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"golang.org/x/net/html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	doc, err := html.Parse(os.Stdin)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Fprintf(os.Stderr, <span class="string">"findlinks1: %v\n"</span>, err)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> check(m, doc) &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"%s:%d\n"</span>, k, v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(m <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>, n *html.Node)</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> n == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> m</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> n.Type == html.ElementNode &#123;</span><br><span class="line">			m[n.Data]++</span><br><span class="line">		&#125;</span><br><span class="line">		m = check(m, n.FirstChild)</span><br><span class="line">		m = check(m, n.NextSibling)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> m</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ./ex1.7 http://www.baidu.com | ./ex5.2</span><br><span class="line">body:1</span><br><span class="line">img:2</span><br><span class="line">map:1</span><br><span class="line">area:1</span><br><span class="line">a:32</span><br><span class="line">i:3</span><br><span class="line">head:1</span><br><span class="line">title:1</span><br><span class="line">style:3</span><br><span class="line">ul:1</span><br><span class="line">meta:4</span><br><span class="line">link:11</span><br><span class="line">form:1</span><br><span class="line">span:5</span><br><span class="line">li:4</span><br><span class="line">p:3</span><br><span class="line">html:1</span><br><span class="line">script:13</span><br><span class="line">noscript:1</span><br><span class="line">div:21</span><br><span class="line">input:14</span><br><span class="line">b:2</span><br></pre></td></tr></table></figure>
<h3 id="Ex-5-5"><a href="#Ex-5-5" class="headerlink" title="Ex 5.5"></a>Ex 5.5</h3><p>Implement countWordsAndImages. (See Exercise 4.9 for word-splitting.)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"golang.org/x/net/html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	url := <span class="string">"http://www.baidu.com"</span></span><br><span class="line">	w, i, err := CountWordsAndImages(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"CountWordsAndImages error: "</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"words = %d,images = %d\n"</span>, w, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CountWordsAndImages</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="params">(words, images <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line">	resp, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	doc, err := html.Parse(resp.Body)</span><br><span class="line">	resp.Body.Close()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		err = fmt.Errorf(<span class="string">"parsing HTML: %s"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	words, images = countWordsAndImages(doc)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countWordsAndImages</span><span class="params">(n *html.Node)</span> <span class="params">(words, images <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> n == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> n.Type == html.ElementNode &#123;</span><br><span class="line">			<span class="keyword">if</span> n.Data == <span class="string">"img"</span> &#123;</span><br><span class="line">				images++</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> n.Type == html.TextNode &#123;</span><br><span class="line">			scanner := bufio.NewScanner(strings.NewReader(n.Data))</span><br><span class="line">			scanner.Split(bufio.ScanWords)</span><br><span class="line">			<span class="keyword">for</span> scanner.Scan() &#123;</span><br><span class="line">				words++</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		w1, i1 := countWordsAndImages(n.FirstChild)</span><br><span class="line">		words += w1</span><br><span class="line">		images += i1</span><br><span class="line">		w2, i2 := countWordsAndImages(n.NextSibling)</span><br><span class="line">		words += w2</span><br><span class="line">		images += i2</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run countwi.go</span><br><span class="line">words = 2805,images = 2</span><br></pre></td></tr></table></figure>
<h3 id="Ex-5-6"><a href="#Ex-5-6" class="headerlink" title="Ex 5.6"></a>Ex 5.6</h3><p>Modify the corner function in gopl.io/ch3/surface (§3.2) to use named results and a bare return statement.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	width, height = <span class="number">600</span>, <span class="number">320</span>            <span class="comment">// canvas size in pixels</span></span><br><span class="line">	cells         = <span class="number">100</span>                 <span class="comment">// number of grid cells</span></span><br><span class="line">	xyrange       = <span class="number">30.0</span>                <span class="comment">// axis ranges (-xyrange..+xyrange)</span></span><br><span class="line">	xyscale       = width / <span class="number">2</span> / xyrange <span class="comment">// pixels per x or y unit</span></span><br><span class="line">	zscale        = height * <span class="number">0.4</span>        <span class="comment">// pixels per z unit</span></span><br><span class="line">	angle         = math.Pi / <span class="number">6</span>         <span class="comment">// angle of x, y axes (=30°)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sin30, cos30 = math.Sin(angle), math.Cos(angle) <span class="comment">// sin(30°), cos(30°)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//fmt.Printf("&lt;svg xmlns='http://www.w3.org/2000/svg' "+</span></span><br><span class="line">	f, err := os.Create(<span class="string">"test.svg"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"create file error "</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Fprintf(f, <span class="string">"&lt;svg xmlns='http://www.w3.org/2000/svg' "</span>+</span><br><span class="line">		<span class="string">"style='stroke: grey; fill: white; stroke-width: 0.7' "</span>+</span><br><span class="line">		<span class="string">"width='%d' height='%d'&gt;"</span>, width, height)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; cells; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; cells; j++ &#123;</span><br><span class="line">			ax, ay := corner(i+<span class="number">1</span>, j)</span><br><span class="line">			bx, by := corner(i, j)</span><br><span class="line">			cx, cy := corner(i, j+<span class="number">1</span>)</span><br><span class="line">			dx, dy := corner(i+<span class="number">1</span>, j+<span class="number">1</span>)</span><br><span class="line">			fmt.Fprintf(f, <span class="string">"&lt;polygon points='%g,%g %g,%g %g,%g %g,%g'/&gt;\n"</span>,</span><br><span class="line">				ax, ay, bx, by, cx, cy, dx, dy)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Fprintln(f, <span class="string">"&lt;/svg&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">corner</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="params">(sx, sy <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// Find point (x,y) at corner of cell (i,j).</span></span><br><span class="line">	x := xyrange * (<span class="keyword">float64</span>(i)/cells - <span class="number">0.5</span>)</span><br><span class="line">	y := xyrange * (<span class="keyword">float64</span>(j)/cells - <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Compute surface height z.</span></span><br><span class="line">	z := f(x, y)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Project (x,y,z) isometrically onto 2-D SVG canvas (sx,sy).</span></span><br><span class="line">	sx = width/<span class="number">2</span> + (x-y)*cos30*xyscale</span><br><span class="line">	sy = height/<span class="number">2</span> + (x+y)*sin30*xyscale - z*zscale</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(x, y <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">	r := math.Hypot(x, y) <span class="comment">// distance from (0,0)</span></span><br><span class="line">	<span class="keyword">return</span> math.Sin(r) / r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Ex-5-7"><a href="#Ex-5-7" class="headerlink" title="Ex 5.7"></a>Ex 5.7</h3><p>Develop startElement and endElement into a general HTML pre Print comment nodes, text nodes, and the attributes of each element (<a href="...">). Use short forms like <img> instead of <img> when an element has no children. Write a test to ensure that the output can be parsed successfully. (See Chapter 11.)</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"golang.org/x/net/html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> _, url := <span class="keyword">range</span> os.Args[<span class="number">1</span>:] &#123;</span><br><span class="line">		outline(url)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">outline</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	resp, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">	doc, err := html.Parse(resp.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	forEachNode(doc, startElement, endElement)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forEachNode</span><span class="params">(n *html.Node, pre, post <span class="keyword">func</span>(n *html.Node)</span>)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> pre != <span class="literal">nil</span> &#123;</span><br><span class="line">		pre(n)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> c := n.FirstChild; c != <span class="literal">nil</span>; c = c.NextSibling &#123;</span><br><span class="line">		forEachNode(c, pre, post)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> post != <span class="literal">nil</span> &#123;</span><br><span class="line">		post(n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> depth <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startElement</span><span class="params">(n *html.Node)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> n.Type == html.ElementNode ||</span><br><span class="line">		n.Type == html.TextNode ||</span><br><span class="line">		n.Type == html.CommentNode &#123;</span><br><span class="line">		<span class="keyword">if</span> n.DataAtom != <span class="number">0</span> &#123; <span class="comment">//去除无法识别标签的节点，如空白的textnode等</span></span><br><span class="line">			<span class="keyword">var</span> attr <span class="keyword">string</span></span><br><span class="line">			<span class="keyword">for</span> _, v := <span class="keyword">range</span> n.Attr &#123;</span><br><span class="line">				attr += <span class="string">" "</span> + v.Key + <span class="string">"='"</span> + v.Val + <span class="string">"'"</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> n.FirstChild == <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Printf(<span class="string">"%*s&lt;%s/&gt;\n"</span>, depth*<span class="number">2</span>, <span class="string">""</span>, n.Data)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Printf(<span class="string">"%*s&lt;%s%s&gt;\n"</span>, depth*<span class="number">2</span>, <span class="string">""</span>, n.Data, attr)</span><br><span class="line">			&#125;</span><br><span class="line">			depth++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">endElement</span><span class="params">(n *html.Node)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> n.Type == html.ElementNode ||</span><br><span class="line">		n.Type == html.TextNode ||</span><br><span class="line">		n.Type == html.CommentNode &#123;</span><br><span class="line">		<span class="keyword">if</span> n.DataAtom != <span class="number">0</span> &#123;</span><br><span class="line">			depth--</span><br><span class="line">			<span class="keyword">if</span> n.FirstChild != <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Printf(<span class="string">"%*s&lt;/%s&gt;\n"</span>, depth*<span class="number">2</span>, <span class="string">""</span>, n.Data)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">$ ./ex5.7 http://gopl.io</span><br><span class="line">&lt;html xmlns=<span class="string">'http://www.w3.org/1999/xhtml'</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta/&gt;</span><br><span class="line">    &lt;title&gt;</span><br><span class="line">    &lt;/title&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">      &lt;tbody&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">          &lt;td&gt;</span><br><span class="line">            &lt;a href=<span class="string">'http://www.informit.com/store/go-programming-language-9780134190440'</span>&gt;</span><br><span class="line">              &lt;img/&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">            &lt;br/&gt;</span><br><span class="line">            &lt;div style=<span class="string">'text-align: center'</span>&gt;</span><br><span class="line">              &lt;a href=<span class="string">'http://www.amazon.com/dp/0134190440'</span>&gt;</span><br><span class="line">                &lt;img/&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              &lt;a href=<span class="string">'http://www.informit.com/store/go-programming-language-9780134190440'</span>&gt;</span><br><span class="line">                &lt;img/&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              &lt;a href=<span class="string">'http://www.barnesandnoble.com/w/1121601944'</span>&gt;</span><br><span class="line">                &lt;img/&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;br/&gt;</span><br><span class="line">          &lt;/td&gt;</span><br><span class="line">          &lt;td width=<span class="string">'500'</span>&gt;</span><br><span class="line">            &lt;h1 class=<span class="string">'center'</span>&gt;</span><br><span class="line">            &lt;/h1&gt;</span><br><span class="line">            &lt;p class=<span class="string">'biblio center'</span>&gt;</span><br><span class="line">              &lt;br/&gt;</span><br><span class="line">              &lt;br/&gt;</span><br><span class="line">              &lt;br/&gt;</span><br><span class="line">              &lt;tt&gt;</span><br><span class="line">              &lt;/tt&gt;</span><br><span class="line">              &lt;tt&gt;</span><br><span class="line">              &lt;/tt&gt;</span><br><span class="line">              &lt;tt&gt;</span><br><span class="line">              &lt;/tt&gt;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">            &lt;div id=<span class="string">'toc'</span>&gt;</span><br><span class="line">              &lt;table&gt;</span><br><span class="line">                &lt;tbody&gt;</span><br><span class="line">                  &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                        &lt;a href=<span class="string">'ch1.pdf'</span>&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                        &lt;a href=<span class="string">'ch1.pdf'</span>&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                        &lt;a href=<span class="string">'ch1.pdf'</span>&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                        &lt;a href=<span class="string">'ch1.pdf'</span>&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                  &lt;/tr&gt;</span><br><span class="line">                  &lt;tr&gt;</span><br><span class="line">                    &lt;td colspan=<span class="string">'2'</span>&gt;</span><br><span class="line">                      &lt;h1&gt;</span><br><span class="line">                        &lt;a href=<span class="string">'https://github.com/adonovan/gopl.io/'</span>&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;a href=<span class="string">'reviews.html'</span>&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;a href=<span class="string">'translations.html'</span>&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;a href=<span class="string">'errata.html'</span>&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                      &lt;/h1&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                  &lt;/tr&gt;</span><br><span class="line">                &lt;/tbody&gt;</span><br><span class="line">              &lt;/table&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;p class=<span class="string">'bio'</span>&gt;</span><br><span class="line">              &lt;a href=<span class="string">'http://golang.org/s/oracle-user-manual'</span>&gt;</span><br><span class="line">                &lt;code&gt;</span><br><span class="line">                &lt;/code&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              &lt;a href=<span class="string">'http://golang.org/lib/godoc/analysis/help.html'</span>&gt;</span><br><span class="line">                &lt;code&gt;</span><br><span class="line">                &lt;/code&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              &lt;a href=<span class="string">'https://github.com/golang/tools/blob/master/refactor/eg/eg.go'</span>&gt;</span><br><span class="line">                &lt;code&gt;</span><br><span class="line">                &lt;/code&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              &lt;a href=<span class="string">'https://github.com/golang/tools/blob/master/refactor/rename/rename.go'</span>&gt;</span><br><span class="line">                &lt;code&gt;</span><br><span class="line">                &lt;/code&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">            &lt;p class=<span class="string">'bio'</span>&gt;</span><br><span class="line">              &lt;a href=<span class="string">'http://www.amazon.com/dp/0131103628?tracking_id=disfordig-20'</span>&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              &lt;a href=<span class="string">'http://www.amazon.com/dp/020161586X?tracking_id=disfordig-20'</span>&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">          &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">      &lt;/tbody&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>遍历TextNode时，含有很多空节点（其实就是空格，也当成了一个节点），或许应该在parse阶段就抛弃这些不是节点的节点。本习题中，我暂时借用了元素节点的字段<code>DataAtom  atom.Atom</code>，若为0，则说明该节点标签无法识别。</p>
<blockquote>
<p>// A Node consists of a NodeType and some Data (tag name for element nodes,<br>// content for text) and are part of a tree of Nodes. Element nodes may also<br>// have a Namespace and contain a slice of Attributes. Data is unescaped, so<br>// that it looks like “a&lt;b” rather than “a&lt;b”. For element nodes, DataAtom<br>// is the atom for Data, or zero if Data is not a known tag name.</p>
</blockquote>
</li>
</ul>
<h3 id="Ex-5-8"><a href="#Ex-5-8" class="headerlink" title="Ex 5.8"></a>Ex 5.8</h3><p>Modify forEachNode so that the pre and post functions return a boolean re indicating whether to continue the traversal. Use it to write a function ElementByID with the following signature that ﬁnds the ﬁrst HTML element with the speciﬁed id attribute. The function should stop the traversal as soon as a match is found.</p>
<p><code>func ElementByID(doc *html.Node, id string) *html.Node</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"golang.org/x/net/html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> custID = <span class="string">"css_index_result"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//var custID = "toc"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> _, url := <span class="keyword">range</span> os.Args[<span class="number">1</span>:] &#123;</span><br><span class="line">		outline(url)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">outline</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	resp, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">	doc, err := html.Parse(resp.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//forEachNode(doc, "", startElement, endElement)</span></span><br><span class="line">	fmt.Printf(<span class="string">"%#v:\n"</span>, getElementByID(doc, custID))</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forEachNode</span><span class="params">(n *html.Node, id <span class="keyword">string</span>, pre, post <span class="keyword">func</span>(n *html.Node, id <span class="keyword">string</span>)</span> <span class="title">bool</span>) *<span class="title">html</span>.<span class="title">Node</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> rtn *html.Node</span><br><span class="line">	<span class="keyword">if</span> pre != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> !pre(n, id) &#123;</span><br><span class="line">			rtn = n</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> c := n.FirstChild; c != <span class="literal">nil</span> &amp;&amp; rtn == <span class="literal">nil</span>; c = c.NextSibling &#123;</span><br><span class="line">		rtn = forEachNode(c, id, pre, post)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> post != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> !post(n, id) &#123;</span><br><span class="line">			rtn = n</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> rtn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> depth <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startElement</span><span class="params">(n *html.Node, id <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> n.Type == html.ElementNode ||</span><br><span class="line">		n.Type == html.TextNode ||</span><br><span class="line">		n.Type == html.CommentNode &#123;</span><br><span class="line">		<span class="keyword">if</span> n.DataAtom != <span class="number">0</span> &#123; <span class="comment">//去除无法识别标签的节点，如空白的textnode等</span></span><br><span class="line">			<span class="keyword">var</span> attr <span class="keyword">string</span></span><br><span class="line">			<span class="keyword">for</span> _, v := <span class="keyword">range</span> n.Attr &#123;</span><br><span class="line">				attr += <span class="string">" "</span> + v.Key + <span class="string">"='"</span> + v.Val + <span class="string">"'"</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> n.FirstChild == <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Printf(<span class="string">"%*s&lt;%s/&gt;\n"</span>, depth*<span class="number">2</span>, <span class="string">""</span>, n.Data)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Printf(<span class="string">"%*s&lt;%s%s&gt;\n"</span>, depth*<span class="number">2</span>, <span class="string">""</span>, n.Data, attr)</span><br><span class="line">			&#125;</span><br><span class="line">			depth++</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> n.Type == html.ElementNode &#123;</span><br><span class="line">			<span class="keyword">for</span> _, v := <span class="keyword">range</span> n.Attr &#123;</span><br><span class="line">				<span class="keyword">if</span> v.Key == <span class="string">"id"</span> &amp;&amp; v.Val == id &#123;</span><br><span class="line">					log.Printf(<span class="string">"%#v\n"</span>, n)</span><br><span class="line">					<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">endElement</span><span class="params">(n *html.Node, id <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> n.Type == html.ElementNode ||</span><br><span class="line">		n.Type == html.TextNode ||</span><br><span class="line">		n.Type == html.CommentNode &#123;</span><br><span class="line">		<span class="keyword">if</span> n.DataAtom != <span class="number">0</span> &#123;</span><br><span class="line">			depth--</span><br><span class="line">			<span class="keyword">if</span> n.FirstChild != <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Printf(<span class="string">"%*s&lt;/%s&gt;\n"</span>, depth*<span class="number">2</span>, <span class="string">""</span>, n.Data)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getElementByID</span><span class="params">(doc *html.Node, id <span class="keyword">string</span>)</span> *<span class="title">html</span>.<span class="title">Node</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> forEachNode(doc, id, startElement, endElement)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ ./ex5.7 http://www.baidu.com</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta/&gt;</span><br><span class="line">    &lt;meta/&gt;</span><br><span class="line">    &lt;meta/&gt;</span><br><span class="line">    &lt;meta/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;link/&gt;</span><br><span class="line">    &lt;title&gt;</span><br><span class="line">    &lt;/title&gt;</span><br><span class="line">    &lt;style id=<span class="string">'css_index'</span> index=<span class="string">'index'</span> <span class="built_in">type</span>=<span class="string">'text/css'</span>&gt;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;style data-for=<span class="string">'debug'</span>&gt;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;style data-for=<span class="string">'result'</span> id=<span class="string">'css_index_result'</span> <span class="built_in">type</span>=<span class="string">'text/css'</span>&gt;</span><br><span class="line">2018/01/02 17:53:11 &amp;html.Node&#123;Parent:(*html.Node)(0xc4201322a0), FirstChild:(*html.Node)(0xc4201336c0), LastChild:(*html.Node)(0xc4201336c0), PrevSibling:(*html.Node)(0xc4201335e0), NextSibling:(*html.Node)(0xc420133730), Type:0x3, DataAtom:0x6f905, Data:<span class="string">"style"</span>, Namespace:<span class="string">""</span>, Attr:[]html.Attribute&#123;html.Attribute&#123;Namespace:<span class="string">""</span>, Key:<span class="string">"data-for"</span>, Val:<span class="string">"result"</span>&#125;, html.Attribute&#123;Namespace:<span class="string">""</span>, Key:<span class="string">"id"</span>, Val:<span class="string">"css_index_result"</span>&#125;, html.Attribute&#123;Namespace:<span class="string">""</span>, Key:<span class="string">"type"</span>, Val:<span class="string">"text/css"</span>&#125;&#125;&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&amp;html.Node&#123;Parent:(*html.Node)(0xc4201322a0), FirstChild:(*html.Node)(0xc4201336c0), LastChild:(*html.Node)(0xc4201336c0), PrevSibling:(*html.Node)(0xc4201335e0), NextSibling:(*html.Node)(0xc420133730), Type:0x3, DataAtom:0x6f905, Data:<span class="string">"style"</span>, Namespace:<span class="string">""</span>, Attr:[]html.Attribute&#123;html.Attribute&#123;Namespace:<span class="string">""</span>, Key:<span class="string">"data-for"</span>, Val:<span class="string">"result"</span>&#125;, html.Attribute&#123;Namespace:<span class="string">""</span>, Key:<span class="string">"id"</span>, Val:<span class="string">"css_index_result"</span>&#125;, html.Attribute&#123;Namespace:<span class="string">""</span>, Key:<span class="string">"type"</span>, Val:<span class="string">"text/css"</span>&#125;&#125;&#125;:</span><br></pre></td></tr></table></figure>
<h3 id="Ex-5-12"><a href="#Ex-5-12" class="headerlink" title="Ex 5.12"></a>Ex 5.12</h3><p>The startElement and endElement functions in gopl.io/ch5/outline2 (§5.5) share a global variable, depth. Turn them into anonymous functions that share a variable local to the outline function.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright © 2016 Alan A. A. Donovan &amp; Brian W. Kernighan.</span></span><br><span class="line"><span class="comment">// License: https://creativecommons.org/licenses/by-nc-sa/4.0/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// See page 133.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Outline prints the outline of an HTML document tree.</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"golang.org/x/net/html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> _, url := <span class="keyword">range</span> os.Args[<span class="number">1</span>:] &#123;</span><br><span class="line">		outline(url)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">outline</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	resp, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">	doc, err := html.Parse(resp.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> depth <span class="keyword">int</span></span><br><span class="line">	startElement := <span class="function"><span class="keyword">func</span><span class="params">(n *html.Node)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> n.Type == html.ElementNode &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"%*s&lt;%s&gt;\n"</span>, depth*<span class="number">2</span>, <span class="string">""</span>, n.Data)</span><br><span class="line">			depth++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	endElement := <span class="function"><span class="keyword">func</span><span class="params">(n *html.Node)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> n.Type == html.ElementNode &#123;</span><br><span class="line">			depth--</span><br><span class="line">			fmt.Printf(<span class="string">"%*s&lt;/%s&gt;\n"</span>, depth*<span class="number">2</span>, <span class="string">""</span>, n.Data)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//!+call</span></span><br><span class="line">	forEachNode(doc, startElement, endElement)</span><br><span class="line">	<span class="comment">//!-call</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//!+forEachNode</span></span><br><span class="line"><span class="comment">// forEachNode calls the functions pre(x) and post(x) for each node</span></span><br><span class="line"><span class="comment">// x in the tree rooted at n. Both functions are optional.</span></span><br><span class="line"><span class="comment">// pre is called before the children are visited (preorder) and</span></span><br><span class="line"><span class="comment">// post is called after (postorder).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forEachNode</span><span class="params">(n *html.Node, pre, post <span class="keyword">func</span>(n *html.Node)</span>)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> pre != <span class="literal">nil</span> &#123;</span><br><span class="line">		pre(n)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> c := n.FirstChild; c != <span class="literal">nil</span>; c = c.NextSibling &#123;</span><br><span class="line">		forEachNode(c, pre, post)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> post != <span class="literal">nil</span> &#123;</span><br><span class="line">		post(n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Ex-5-13"><a href="#Ex-5-13" class="headerlink" title="Ex 5.13"></a>Ex 5.13</h3><p>Modify crawl to make local copies of the pages it ﬁnds, creating directories as necessary. Don’t make copies of pages that come from a different domain. For example, if the original page comes from golang.org, save all ﬁles from there, but exclude ones from vimeo.com.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"net/url"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"golang.org/x/net/html"</span></span><br><span class="line">	<span class="string">"gopl.io/ch5/links"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Extract makes an HTTP GET request to the specified URL, parses</span></span><br><span class="line"><span class="comment">// the response as HTML, and returns the links in the HTML document.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Extract</span><span class="params">(urlstr <span class="keyword">string</span>)</span> <span class="params">([]<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">	resp, err := http.Get(urlstr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> resp.StatusCode != http.StatusOK &#123;</span><br><span class="line">		resp.Body.Close()</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"getting %s: %s"</span>, urlstr, resp.Status)</span><br><span class="line">	&#125;</span><br><span class="line">	doc, err := html.Parse(resp.Body)</span><br><span class="line">	resp.Body.Close()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"parsing %s as HTML: %v"</span>, urlstr, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> links []<span class="keyword">string</span></span><br><span class="line">	visitNode := <span class="function"><span class="keyword">func</span><span class="params">(n *html.Node)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> n.Type == html.ElementNode &amp;&amp; n.Data == <span class="string">"a"</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> _, a := <span class="keyword">range</span> n.Attr &#123;</span><br><span class="line">				<span class="keyword">if</span> a.Key != <span class="string">"href"</span> &#123;</span><br><span class="line">					<span class="keyword">continue</span></span><br><span class="line">				&#125;</span><br><span class="line">				link, err := resp.Request.URL.Parse(a.Val)</span><br><span class="line">				<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">					<span class="keyword">continue</span> <span class="comment">// ignore bad URLs</span></span><br><span class="line">				&#125;</span><br><span class="line">				links = <span class="built_in">append</span>(links, link.String())</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	forEachNode(doc, visitNode, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">return</span> links, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//!-Extract</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Copied from gopl.io/ch5/outline2.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forEachNode</span><span class="params">(n *html.Node, pre, post <span class="keyword">func</span>(n *html.Node)</span>)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> pre != <span class="literal">nil</span> &#123;</span><br><span class="line">		pre(n)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> c := n.FirstChild; c != <span class="literal">nil</span>; c = c.NextSibling &#123;</span><br><span class="line">		forEachNode(c, pre, post)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> post != <span class="literal">nil</span> &#123;</span><br><span class="line">		post(n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">breadthFirst</span><span class="params">(f <span class="keyword">func</span>(item <span class="keyword">string</span>, host []<span class="keyword">string</span>)</span> []<span class="title">string</span>, <span class="title">worklist</span> []<span class="title">string</span>)</span> &#123;</span><br><span class="line">	seen := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">bool</span>)</span><br><span class="line">	host := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="built_in">len</span>(worklist))</span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> worklist &#123;</span><br><span class="line">		u, err := url.Parse(v)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"initial url parse failed"</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		host[i] = u.Host</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> <span class="built_in">len</span>(worklist) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		items := worklist</span><br><span class="line">		worklist = <span class="literal">nil</span></span><br><span class="line">		<span class="keyword">for</span> _, item := <span class="keyword">range</span> items &#123;</span><br><span class="line">			<span class="keyword">if</span> !seen[item] &#123;</span><br><span class="line">				seen[item] = <span class="literal">true</span></span><br><span class="line">				worklist = <span class="built_in">append</span>(worklist, f(item, host)...)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//!-breadthFirst</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//!+crawl</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">crawl</span><span class="params">(urlstr <span class="keyword">string</span>, sl []<span class="keyword">string</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line">	fmt.Println(urlstr)</span><br><span class="line">	copycontent(urlstr, sl)</span><br><span class="line">	list, err := links.Extract(urlstr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Print(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> list</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copycontent</span><span class="params">(s <span class="keyword">string</span>, sl []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	u, err := url.Parse(s)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"url parse failed"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> sl &#123;</span><br><span class="line">		<span class="keyword">if</span> u.Host == v &#123;</span><br><span class="line">			resp, err := http.Get(s)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Println(err)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> resp.StatusCode != http.StatusOK &#123;</span><br><span class="line">				resp.Body.Close()</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//fmt.Println(path)</span></span><br><span class="line">			dir, _ := os.Getwd() <span class="comment">//当前的目录</span></span><br><span class="line">			<span class="keyword">var</span> filename, filepart, dirpart <span class="keyword">string</span></span><br><span class="line">			ns := strings.Count(u.Path, <span class="string">"/"</span>)</span><br><span class="line">			<span class="keyword">if</span> ns == <span class="number">0</span> || ns == <span class="number">1</span> &amp;&amp; <span class="built_in">len</span>(u.Path) == <span class="number">1</span> &#123;</span><br><span class="line">				filepart = <span class="string">""</span></span><br><span class="line">				filename = strconv.FormatInt(time.Now().Unix(), <span class="number">10</span>) + <span class="string">".html"</span></span><br><span class="line">				dirpart = <span class="string">"/"</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				filepart = u.Path[strings.LastIndex(u.Path, <span class="string">"/"</span>)+<span class="number">1</span>:]</span><br><span class="line">				dirpart = u.Path[:strings.LastIndex(u.Path, <span class="string">"/"</span>)+<span class="number">1</span>]</span><br><span class="line">				<span class="keyword">if</span> strings.Contains(filepart, <span class="string">"."</span>) &#123;</span><br><span class="line">					filename = filepart</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					dirpart = u.Path</span><br><span class="line">					filename = strconv.FormatInt(time.Now().Unix(), <span class="number">10</span>) + <span class="string">".html"</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			fullpath := dir + <span class="string">"/"</span> + u.Host + dirpart</span><br><span class="line">			_, err = os.Stat(fullpath)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				err = os.MkdirAll(fullpath, os.ModePerm) <span class="comment">//在当前目录下生成md目录</span></span><br><span class="line">				<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">					fmt.Println(<span class="string">"create folder failed! "</span>, fullpath, err)</span><br><span class="line">					<span class="keyword">return</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			filename = dir + <span class="string">"/"</span> + u.Host + dirpart + <span class="string">"/"</span> + filename</span><br><span class="line">			f, err := os.Create(filename)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"create file error:"</span>, err, s)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			_, err = io.Copy(f, resp.Body)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"failed in copy"</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			resp.Body.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	breadthFirst(crawl, os.Args[<span class="number">1</span>:])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
      
  <div class="article-statement">
    <hr>  
    1.如果本文帮到了您，不妨点一下右下角的 <a>分享到</a> 按钮。<br>
    2.除非注明，本博文章均为原创，转载请以链接形式标明本文地址。<br>
  </div>

    </div>
    <footer class="article-footer">
      
        <a data-url="https://mooncaker816.github.io/2017/12/28/The-Go-Programming-Language-Ex (6)/" data-id="cjc0ijycw000qvrw5ek0bnbma" class="article-share-link" data-share="baidu" data-title="The Go Programming Language Ex（6）">分享到</a>
      

      
      
        <a href="/2017/12/28/The-Go-Programming-Language-Ex (6)/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2017/12/28/The-Go-Programming-Language-Ex (6)/" itemprop="commentCount"></span>
          文章评论
        </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go-Func/">Go Func</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go-crawler/">Go crawler</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/The-Go-Programming-Language-Ex/">The Go Programming Language Ex</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/29/The-Go-Programming-Language-Ex (7)/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          The Go Programming Language Ex（7）
        
      </div>
    </a>
  
  
    <a href="/2017/12/24/The-Go-Programming-Language-Ex (5)/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">The Go Programming Language Ex（5）</div>
    </a>
  
</nav>

  
</article>



  <section id="comments" class="vcomment">
  </section>

</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-BitMap/">Go BitMap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-Func/">Go Func</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-In-Action/">Go In Action</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-Interface/">Go Interface</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-JSON/">Go JSON</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-Method/">Go Method</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-Scanner/">Go Scanner</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-TCP-Conn/">Go TCP Conn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-array/">Go array</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-breadth-first-crawler/">Go breadth first crawler</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-cache-store/">Go cache store</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-chat-room/">Go chat room</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-crawler/">Go crawler</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-goroutine/">Go goroutine</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-interface/">Go interface</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-map/">Go map</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-method/">Go method</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-package/">Go package</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-select/">Go select</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-slice/">Go slice</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-template/">Go template</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-type/">Go type</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/The-Go-Programming-Language-Ex/">The Go Programming Language Ex</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Go-BitMap/" style="font-size: 10px;">Go BitMap</a> <a href="/tags/Go-Func/" style="font-size: 10px;">Go Func</a> <a href="/tags/Go-In-Action/" style="font-size: 17.5px;">Go In Action</a> <a href="/tags/Go-Interface/" style="font-size: 10px;">Go Interface</a> <a href="/tags/Go-JSON/" style="font-size: 10px;">Go JSON</a> <a href="/tags/Go-Method/" style="font-size: 10px;">Go Method</a> <a href="/tags/Go-Scanner/" style="font-size: 10px;">Go Scanner</a> <a href="/tags/Go-TCP-Conn/" style="font-size: 10px;">Go TCP Conn</a> <a href="/tags/Go-array/" style="font-size: 10px;">Go array</a> <a href="/tags/Go-breadth-first-crawler/" style="font-size: 10px;">Go breadth first crawler</a> <a href="/tags/Go-cache-store/" style="font-size: 10px;">Go cache store</a> <a href="/tags/Go-chat-room/" style="font-size: 10px;">Go chat room</a> <a href="/tags/Go-crawler/" style="font-size: 10px;">Go crawler</a> <a href="/tags/Go-goroutine/" style="font-size: 15px;">Go goroutine</a> <a href="/tags/Go-interface/" style="font-size: 10px;">Go interface</a> <a href="/tags/Go-map/" style="font-size: 12.5px;">Go map</a> <a href="/tags/Go-method/" style="font-size: 10px;">Go method</a> <a href="/tags/Go-package/" style="font-size: 10px;">Go package</a> <a href="/tags/Go-select/" style="font-size: 10px;">Go select</a> <a href="/tags/Go-slice/" style="font-size: 12.5px;">Go slice</a> <a href="/tags/Go-template/" style="font-size: 10px;">Go template</a> <a href="/tags/Go-type/" style="font-size: 10px;">Go type</a> <a href="/tags/The-Go-Programming-Language-Ex/" style="font-size: 20px;">The Go Programming Language Ex</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/01/04/The-Go-Programming-Language-Ex (11)/">The Go Programming Language Ex（11）</a>
          </li>
        
          <li>
            <a href="/2018/01/03/The-Go-Programming-Language-Ex (10)/">The Go Programming Language Ex（10）</a>
          </li>
        
          <li>
            <a href="/2018/01/01/The-Go-Programming-Language-Ex (9)/">The Go Programming Language Ex（9）</a>
          </li>
        
          <li>
            <a href="/2017/12/31/The-Go-Programming-Language-Ex (8)/">The Go Programming Language Ex（8）</a>
          </li>
        
          <li>
            <a href="/2017/12/29/The-Go-Programming-Language-Ex (7)/">The Go Programming Language Ex（7）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="https://github.com/mooncaker816" target="_blank">我的github</a>
          </li>
        
          <li>
            <a href="https://coding.net/u/mooncaker816" target="_blank">我的coding</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Mingle<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a><br/>
      <span id="busuanzi_container_site_pv">
        总访问量 <a href="http://service.ibruce.info/" target="_blank"><span id="busuanzi_value_site_pv"></span></a> 次
      </span>
      <span id="busuanzi_container_site_uv">
        <a href="http://service.ibruce.info/" target="_blank"><span id="busuanzi_value_site_uv"></span></a> 人.
      </span>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->


<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/script.js"></script>


  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    var GUEST_INFO = ['nick','mail','link'];
    var guest_info = 'nick,mail,link'.split(',').filter(function(item){
        return GUEST_INFO.indexOf(item) > -1
    });
    var notify = 'false' == true;
    var verify = 'false' == true;
    new Valine({
        el: '.vcomment',
        notify: notify,
        verify: verify,
        appId: "urzxMG6IH6XwD3AIW0VH4lMb-gzGzoHsz",
        appKey: "WPbRVjy6oFOvnxYJJx9uTRR9",
        placeholder: "来侃一侃~",
        pageSize:'10',
        avatar:'identicon',
        lang:'zh-cn'
    });
</script>


</div>
</body>
</html>
